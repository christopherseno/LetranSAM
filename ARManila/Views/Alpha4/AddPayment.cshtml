@model ARManila.Models.Alpha4Payment

@{
    ViewBag.Title = "AddPayment";
}


<div class="content">
    <nav class="breadcrumb push bg-body-extra-light rounded-pill px-4 py-2">
        <span class="breadcrumb-item">Alpha4 Backaccount Menu</span>
        <span class="breadcrumb-item active">Add Payment</span>
    </nav>
    <div class="block block-rounded">
        <div class="block-content">
            <div class="row">
                <div class="col-lg-4">
                    <h4>Add Payment to Alpha4 Backaccount</h4>
                    <p class="text-muted">
                        Student No: @(Model.Alpha4.StudentId.HasValue ? Model.Alpha4.Student.StudentNo : "No Valid Student No")
                        <br />Student Name: @(Model.Alpha4.StudentId.HasValue ? Model.Alpha4.Student.FullName256  : Model.Alpha4.FullName)
                        <br />Backaccount Amount: @Model.Alpha4.Amount.ToString("#,##0.00")
                        <br />BA Date: @Model.Alpha4.BADate
                    </p>
                </div>
                <div class="col-lg-8 col-xl-5">
                    @using (Html.BeginForm("AddPayment", "Alpha4", FormMethod.Post, new { @class = "mb-5" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                        @Html.Hidden("Alpha4Id", Model.Alpha4.Id)
                        <div class="row mb-4">
                            <label class="col-sm-4 col-form-label" for="">OR Number</label>
                            <div class="col-sm-8">
                                <input type="text" id="OrNo" name="OrNo" placeholder="OR Number" class="form-control" />
                                <input type="button" class="btn btn-danger" id="ornofinderbutton" value="OR Number Finder" />
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label class="col-sm-4 col-form-label" for="">Amount</label>
                            <div class="col-sm-8">
                                <input id="Amount" name="Amount" value="0.00" class="form-control" type="number" step="0.01"/>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label class="col-sm-4 col-form-label" for="">Payment Date</label>
                            <div class="col-sm-8">
                                <input type="date" id="PaymentDate" name="PaymentDate" class="form-control" />
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label class="col-sm-4 col-form-label" for="">Remarks</label>
                            <div class="col-sm-8">
                                <input type="text" id="Remarks" name="Remarks" placeholder="Remarks" class="form-control" />
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-sm-8 ms-auto">
                                <input type="submit" value="Save" class="btn btn-primary" />
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<div>
    @Html.ActionLink("Back to List", "Index")
</div>
<div class="modal" tabindex="-1" id="searchornomodal" role="dialog" aria-labelledby="modal-dialog modal-lg" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="block block-rounded shadow-none mb-0">
                <div class="block-header block-header-default">
                    <h3 class="block-title">Search OR Number</h3>
                    <div class="block-options">
                        <button type="button" class="btn-block-option" data-bs-dismiss="modal" aria-label="Close">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="block-content fs-sm">
                    <div class="mb-4">
                        <div class="input-group">
                            <input type="text" id="searchornotext" placeholder="OR No/Lastname/Firstname" />
                            <button class="btn btn-primary" id="searchornobutton">Search</button>
                            <button class="buttonload" style="display:none" id="searchornoloading">
                                <i class="fa fa-spinner fa-spin"></i>Loading
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="searchornotable" class="table table-striped table-bordered"><thead><tr><td>OR Number</td><td>Student No</td><td>Student Name</td><td>Date</td><td>Amount</td><td>Payment For</td></tr></thead></table>
                    </div>
                </div>
                <div class="block-content block-content-full block-content-sm text-end border-top">
                    <button type="button" class="btn btn-alt-secondary" data-bs-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts
{

    <script type="text/javascript">
        $(document).ready(function () {
            $("#linkClose").click(function () {
                $("#divError").hide('fade');
            });
            $("#ornofinderbutton").click(function () {
                $("#searchornotext").val("");
                $('#searchornotable').empty();
                $("#searchornomodal").modal('show');
            });
            $("#searchornobutton").click(function () {
                getORNumbers($("#searchornotext").val());
            });
        });
        function getOrNo(or, amount, paymentdate) {                        
            $("#OrNo").val(or);
            $("#Amount").val(amount);
            $("#PaymentDate").val(paymentdate);
            $("#searchornomodal").modal('hide');
        }
        function getORNumbers(searchtext) {
            $.ajax({
                type: "GET",
                url: "/SearchOrNo/" + searchtext,
                beforeSend: function (data) {
                    $("#searchornoloading").css("display", "inline");
                },
                complete: function (data) {
                    $("#searchornoloading").css("display", "none");
                },
                success: function (data) {
                    var searchstudenttable = $('#searchornotable');
                    searchstudenttable.empty();
                    searchstudenttable.append('<thead class="thead-dark"><tr><th>OR Number</th><th>Student No</th><th>Student Name</th><th>Date</th>' +
                        '<th>Amount</th><th>Payment For</th></tr ></thead > <tbody>');
                    $.each(data, function (index, val) {
                        searchstudenttable.append('<tr><td><a href="#" onclick="getOrNo(' + val.OrNumber + ',' + val.Amount + ', &quot;' + val.Date + '&quot;)">' + val.OrNumber + '</a></td><td>' + val.StudentNo + '</td><td>' + val.Fullname + '</td><td>' + val.Date + '</td><td>' + val.Amount + '</td><td>' + val.Description + '</td></tr>');
                    });
                },
                error: function (data) {

                }
            });
        }


    </script>
}