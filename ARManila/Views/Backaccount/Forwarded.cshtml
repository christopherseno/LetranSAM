@model List<ARManila.Models.BackaccountWrapper>

@{
    ViewBag.Title = "Index";
}

<div class="p-3">
    <h2>List of Backaccounts Forwarded to this period.</h2>
    <br />
    @if (Model != null && Model.Count > 0)
    {
        <table class="table table-bordered" id="table">
            <thead>
                <tr>
                    <th>Student No</th>
                    <th>Student Name</th>
                    <th>
                        Backaccount From
                    </th>
                    <th>
                        Amount
                    </th>                    
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    var a = "key" + item.BackaccountId;
                <tr>
                    <td>@item.StudentNo</td>
                    <td>@item.StudentName</td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Period)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Amount)
                    </td>
                    <td>
                        <button data-toggle="collapse" data-target="#@a">View Details</button>
                        <br />
                        <div id="@a" class="collapse">
                            @if (item.BackaccountPaymentWrappers.Count > 0)
                            {
                                <table class="table table-bordered">
                                    <tr>
                                        <th>OR No</th>
                                        <th>Transaction Date</th>
                                        <th>Amount</th>
                                        <th></th>
                                    </tr>
                                    @foreach (var detail in item.BackaccountPaymentWrappers)
                                    {
                                        <tr>
                                            <td>@detail.ORNo</td>
                                            <td>@detail.PaymentDate</td>
                                            <td>@detail.Amount</td>
                                            <td> @Html.ActionLink("Unlink Payment", "UnlinkBackaccountPayment", "Backaccount", new { id = detail.BackaccountPaymentId }, new { @class = "btn btn-primary" })</td>
                                        </tr>

                                    }
                                </table>
                            }
                            else
                            {
                                <span>No Payment associated with this backaccount</span>
                            }
                        </div>
                    </td>
                    <td>
                        @Html.ActionLink("Edit", "Edit", new { id = item.BackaccountId })
                    </td>
                    <td>
                        <a href="#" class="btn btn-primary" onclick="deletebackaccount(@item.BackaccountId)" data-toggle="modal" data-target="#confirm-submit">Delete</a>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    }
</div>
<div class="modal fade" id="confirm-submit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirm Delete</h2>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this backaccount?
                <table class="table">
                    <tr>
                        <th>Period</th>
                        <td id="Period"></td>
                    </tr>
                    <tr>
                        <th>Amount</th>
                        <td id="Amount"></td>
                    </tr>
                </table>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a href="#" id="submit" class="btn btn-success success">Submit</a>
            </div>
        </div>
    </div>
</div>

@section scripts
{
    <script type="text/javascript">
        var backaccountidfordeletion = 0;
        function deletebackaccount (backaccountid) {
            var backaccountarray = @Html.Raw(Json.Encode(Model));
            for (var i = 0; i < backaccountarray.length; i++) {
                if (backaccountarray[i].BackaccountId == backaccountid) {
                    $('#Period').text((backaccountarray[i].Period));
                    $('#Amount').text((backaccountarray[i].Amount));
                    backaccountidfordeletion = backaccountarray[i].BackaccountId;
                }
            }
        }

        $('#submit').click(function () {
            window.location.href = '@Url.Action("DeleteBackaccount", "Backaccount")/' + backaccountidfordeletion;
            //$.ajax({
            //    type: "GET",
            //    url: "/Backaccount/DeleteBackaccount/" + backaccountidfordeletion,
            //    beforeSend: function (data) {
            //        $("#deletebackaccountloading").css("display", "inline");
            //    },
            //    complete: function (data) {
            //        $("#deletebackaccountloading").css("display", "none");
            //    },
            //    success: function (data) {

            //    },
            //    error: function (data) {
            //        alert("Error");
            //        $("#deletebackaccountloading").css("display", "none");
            //    }
            //});
        });
    </script>
}