@model ARManila.Models.OtherDTO.FeeDTO
@{
    ViewBag.Title = "Index";
}

<ul class="nav nav-tabs" id="feeTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="tuition-tab" data-bs-toggle="tab" data-bs-target="#tuition" type="button" role="tab">Tuition</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="misc-tab" data-bs-toggle="tab" data-bs-target="#misc" type="button" role="tab">Miscellaneous</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="supplemental-tab" data-bs-toggle="tab" data-bs-target="#supplemental" type="button" role="tab">Supplemental</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="various-tab" data-bs-toggle="tab" data-bs-target="#various" type="button" role="tab">Various</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="others-tab" data-bs-toggle="tab" data-bs-target="#others" type="button" role="tab">Others</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="lab-tab" data-bs-toggle="tab" data-bs-target="#lab" type="button" role="tab">Lab</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="aircon-tab" data-bs-toggle="tab" data-bs-target="#aircon" type="button" role="tab">Aircon</button>
    </li>
</ul>
<div class="tab-content mt-3" id="feeTabContent">
    <div class="tab-pane fade show active" id="tuition" role="tabpanel">
        @if (Model.TuitionFees != null && Model.TuitionFees.Any())
        {
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        @if (Model.Period.EducLevelID >= 3)
                        {
                            <th>Program</th>
                        }
                        @if (Model.Period.EducLevelID <= 3)
                        {
                            <th>Grade</th>
                        }
                        <th class="text-end">Payment Mode</th>
                        <th class="text-end">Amount</th>
                        @if (Model.Period.EducLevelID < 3)
                        {
                            <th>Downpayment</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var fee in Model.TuitionFees)
                    {
                        <tr>
                            @if (Model.Period.EducLevelID >= 3)
                            {
                                <th>@(fee.ProgramID.HasValue ? fee.Progam.ProgramCode : "" )</th>
                            }
                            @if (Model.Period.EducLevelID <= 3)
                            {
                                <th>@fee.YearLevel</th>
                            }
                            <th class="text-end">@fee.Paymode.Description</th>
                            <th class="text-end">@fee.Amount.ToString("#,##0.00")</th>
                            @if (Model.Period.EducLevelID < 3)
                            {
                                <th>@(fee.Downpayment.HasValue? fee.Downpayment.Value.ToString("#,##0.00") :"0.00")</th>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No records available.</p>
        }
    </div>

    <div class="tab-pane fade" id="misc" role="tabpanel">
        @if (Model.MiscFees != null && Model.MiscFees.Any())
        {
            // Check if any misc fee has a YearLevel value to conditionally show grade column
            var hasYearLevel = Model.MiscFees.Any(m => m.YearLevel.HasValue);
            var showGradeColumn = hasYearLevel || Model.Period.EducLevelID < 3;


            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Description</th>
                        <th class="text-end">Fee Name</th>
                        <th>For New Student</th>
                        @if (showGradeColumn)
                        {
                            <th>Grade</th>
                        }
                        <th>Account Code</th>
                        <th>Account Name</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var fee in Model.MiscFees)
                    {
                        <tr>
                            <td>@fee.Description</td>
                            <td class="text-end">@(fee.Fee != null && fee.Fee.FeeNameID.HasValue && fee.Fee.FeeName != null ? fee.Fee.FeeName.FeeName1 : "")</td>
                            <td>@(fee.NewStatus.HasValue && fee.NewStatus.Value ? "Yes" : "No")</td>
                            @if (showGradeColumn)
                            {
                                <td>@(fee.YearLevel.HasValue ? fee.YearLevel.Value.ToString() : "")</td>
                            }
                            <td>
                                @{
                                    var accountCode = "";
                                    if (fee.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (fee.Fee.SubAcctID.HasValue && fee.Fee.SubChartOfAccounts != null)
                                        {
                                            accountCode = fee.Fee.SubChartOfAccounts.SubAcctNo ?? "";
                                        }
                                        else if (fee.Fee.AcctID.HasValue && fee.Fee.ChartOfAccounts != null)
                                        {
                                            accountCode = fee.Fee.ChartOfAccounts.AcctNo ?? "";
                                        }
                                    }
                                }
                                @accountCode
                            </td>
                            <td>
                                @{
                                    var accountName = "";
                                    if (fee.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (fee.Fee.SubAcctID.HasValue && fee.Fee.SubChartOfAccounts != null)
                                        {
                                            accountName = fee.Fee.SubChartOfAccounts.SubbAcctName ?? "";
                                        }
                                        else if (fee.Fee.AcctID.HasValue && fee.Fee.ChartOfAccounts != null)
                                        {
                                            accountName = fee.Fee.ChartOfAccounts.AcctName ?? "";
                                        }
                                    }
                                }
                                @accountName
                            </td>
                            <td class="text-end">@fee.Amount.ToString("#,##0.00")</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No records available.</p>
        }
    </div>

    <div class="tab-pane fade" id="supplemental" role="tabpanel">
        @if (Model.SupplementalFees != null && Model.SupplementalFees.Any())
        {

            // Check if any supplemental fee has a YearLevel value to conditionally show grade column
            var suppHasYearLevel = Model.SupplementalFees.Any(m => m.YearLevel.HasValue);
            var suppShowGradeColumn = suppHasYearLevel || Model.Period.EducLevelID < 3;


            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Description</th>
                        <th class="text-end">Fee Name</th>
                        <th>For New Student</th>
                        @if (suppShowGradeColumn)
                        {
                            <th>Grade</th>
                        }
                        <th>Account Code</th>
                        <th>Account Name</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.SupplementalFees)
                    {
                        <tr>
                            <td>@item.Description</td>
                            <td class="text-end">@(item.Fee != null && item.Fee.FeeNameID.HasValue && item.Fee.FeeName != null ? item.Fee.FeeName.FeeName1 : "")</td>
                            <td>@(item.NewStatus.HasValue && item.NewStatus.Value ? "Yes" : "No")</td>
                            @if (suppShowGradeColumn)
                            {
                                <td>@(item.YearLevel.HasValue ? item.YearLevel.Value.ToString() : "")</td>
                            }
                            <td>
                                @{
                                    var suppAccountCode = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            suppAccountCode = item.Fee.SubChartOfAccounts.SubAcctNo ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            suppAccountCode = item.Fee.ChartOfAccounts.AcctNo ?? "";
                                        }
                                    }
                                }
                                @suppAccountCode
                            </td>
                            <td>
                                @{
                                    var suppAccountName = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            suppAccountName = item.Fee.SubChartOfAccounts.SubbAcctName ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            suppAccountName = item.Fee.ChartOfAccounts.AcctName ?? "";
                                        }
                                    }
                                }
                                @suppAccountName
                            </td>
                            <td class="text-end">@item.Amount.ToString("#,##0.00")</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No records available.</p>
        }
    </div>

    <div class="tab-pane fade" id="various" role="tabpanel">
        @if (Model.VariousFees != null && Model.VariousFees.Any())
        {

            // Check if any various fee has a YearLevel value to conditionally show grade column
            var varHasYearLevel = Model.VariousFees.Any(m => m.YearLevel.HasValue);
            var varShowGradeColumn = varHasYearLevel || Model.Period.EducLevelID < 3;
            // Check if any various fee has a ProgramID to conditionally show program column
            var varHasProgram = Model.VariousFees.Any(m => m.ProgramID.HasValue);

            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Description</th>
                        @if (varHasProgram || Model.Period.EducLevelID >= 3)
                        {
                            <th>Program</th>
                        }
                        @if (varShowGradeColumn)
                        {
                            <th>Grade</th>
                        }
                        <th>Account Code</th>
                        <th>Account Name</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.VariousFees)
                    {
                        <tr>
                            <td>@item.Description</td>
                            @if (varHasProgram || Model.Period.EducLevelID >= 3)
                            {
                                <td>@(item.ProgramID.HasValue && item.Progam != null ? item.Progam.ProgramCode : "")</td>
                            }
                            @if (varShowGradeColumn)
                            {
                                <td>@(item.YearLevel.HasValue ? item.YearLevel.Value.ToString() : "")</td>
                            }
                            <td>
                                @{
                                    var varAccountCode = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            varAccountCode = item.Fee.SubChartOfAccounts.SubAcctNo ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            varAccountCode = item.Fee.ChartOfAccounts.AcctNo ?? "";
                                        }
                                    }
                                }
                                @varAccountCode
                            </td>
                            <td>
                                @{
                                    var varAccountName = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            varAccountName = item.Fee.SubChartOfAccounts.SubbAcctName ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            varAccountName = item.Fee.ChartOfAccounts.AcctName ?? "";
                                        }
                                    }
                                }
                                @varAccountName
                            </td>
                            <td class="text-end">@item.Amount.ToString("#,##0.00")</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No records available.</p>
        }
    </div>

    <div class="tab-pane fade" id="others" role="tabpanel">
        @if (Model.OtherFees != null && Model.OtherFees.Any())
        {
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Description</th>
                        <th>Subject</th>
                        <th>Section</th>
                        <th>Account Code</th>
                        <th>Account Name</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OtherFees)
                    {
                        <tr>
                            <td>@item.Description</td>
                            <td>@(item.Subject != null ? item.Subject.SubjectCode : "")</td>
                            <td>@(item.Section != null ? item.Section.SectionName : "")</td>
                            <td>
                                @{
                                    var otherAccountCode = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            otherAccountCode = item.Fee.SubChartOfAccounts.SubAcctNo ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            otherAccountCode = item.Fee.ChartOfAccounts.AcctNo ?? "";
                                        }
                                    }
                                }
                                @otherAccountCode
                            </td>
                            <td>
                                @{
                                    var otherAccountName = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            otherAccountName = item.Fee.SubChartOfAccounts.SubbAcctName ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            otherAccountName = item.Fee.ChartOfAccounts.AcctName ?? "";
                                        }
                                    }
                                }
                                @otherAccountName
                            </td>
                            <td class="text-end">@item.Amount.ToString("#,##0.00")</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No records available.</p>
        }
    </div>

    <div class="tab-pane fade" id="lab" role="tabpanel">
        @if (Model.LabFees != null && Model.LabFees.Any())
        {

                // Check if any lab fee has a YearLevel value to conditionally show grade column
                var labHasYearLevel = Model.LabFees.Any(m => m.YearLevel.HasValue);
                var labShowGradeColumn = labHasYearLevel;

            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Description</th>
                        <th>Subject</th>
                        @if (labShowGradeColumn)
                        {
                            <th>Year Level</th>
                        }
                        <th>Account Code</th>
                        <th>Account Name</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.LabFees)
                    {
                        <tr>
                            <td>@item.Description</td>
                            <td>@(item.Subject != null ? item.Subject.SubjectCode : "")</td>
                            @if (labShowGradeColumn)
                            {
                                <td>@(item.YearLevel.HasValue ? item.YearLevel.Value.ToString() : "")</td>
                            }
                            <td>
                                @{
                                    var labAccountCode = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            labAccountCode = item.Fee.SubChartOfAccounts.SubAcctNo ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            labAccountCode = item.Fee.ChartOfAccounts.AcctNo ?? "";
                                        }
                                    }
                                }
                                @labAccountCode
                            </td>
                            <td>
                                @{
                                    var labAccountName = "";
                                    if (item.Fee != null)
                                    {
                                        // Prefer SubChartOfAccounts, fallback to ChartOfAccounts
                                        if (item.Fee.SubAcctID.HasValue && item.Fee.SubChartOfAccounts != null)
                                        {
                                            labAccountName = item.Fee.SubChartOfAccounts.SubbAcctName ?? "";
                                        }
                                        else if (item.Fee.AcctID.HasValue && item.Fee.ChartOfAccounts != null)
                                        {
                                            labAccountName = item.Fee.ChartOfAccounts.AcctName ?? "";
                                        }
                                    }
                                }
                                @labAccountName
                            </td>
                            <td class="text-end">@item.Amount.ToString("#,##0.00")</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No records available.</p>
        }
    </div>

    <div class="tab-pane fade" id="aircon" role="tabpanel">
        @if (Model.AirconFees != null && Model.AirconFees.Any())
        {
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Description</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.AirconFees)
                    {
                        <tr>
                            <td>Aircon</td>
                            <td class="text-end">@(item.Amount.HasValue ? item.Amount.Value.ToString("#,##0.00") : "0.00")</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-muted">No records available.</p>
        }
    </div>
</div>